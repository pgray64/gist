<div id="post" v-cloak>
    <div class="container" v-if="isLoggedIn">
        <account-notification-banner></account-notification-banner>
    </div>
    <div class="container pt-1 pt-sm-3 pb-5">
        <h5><a :href="getUserUrl(username)">{{username}}</a></h5>
        <div v-if="rebloggedPost" class="text-info small text-uppercase font-weight-bold"><span class="mr-1 fa fa-retweet"></span>Reblogged</div>
        <div :class="[rebloggedPost ? 'p-3 border rounded': '']" class="mt-2">
            <div class="user-content" v-if="rebloggedPost">
                <h6><a :href="getOriginalUserUrl(username)" class="text-dark">{{rebloggedPost.username}}</a></h6>
                <h4>
                    <a :href="getOriginalUrl()">{{title}}</a>
                </h4>
            </div>
            <h4 v-else>
                {{title}}
            </h4>
            <div v-if="contentType === 'text' || (rebloggedPost && rebloggedPost.contentType === 'text')"
                 class="rounded user-content">{{getTextContent()}}</div>
            <div v-else-if="contentType === 'image' || (rebloggedPost && rebloggedPost.contentType === 'image')" class="mt-2">
                <img :src="getImageUrl()" style="max-width:100%;max-height:600px" class="rounded"/>
            </div>
        </div>
        <div class="mt-3" v-if="!addingComment">
            <ajax-button type="button" :syncing="submittingReblog" @click="reblog()" class="btn btn-sm btn-info mb-1 mr-1" :disabled="!canReblog"><span class="fa fa-share mr-1"></span>Reblog</ajax-button>
            <button type="button" class="btn btn-sm btn-outline-primary mb-1" @click="showAddComment()"><span class="fa fa-comment-o mr-1"></span>Add a comment</button>
        </div>
        <div class="mt-3" v-if="addingComment">
        <textarea style="resize:none" rows="4" class="form-control" v-model="newCommentContent"
                  maxLength=500 type="text" :disabled="submittingComment"></textarea>
            <div class="text-right mt-2">
                <button type="button" class="btn btn-sm btn-outline-info mb-1" @click="cancelAddComment()"></span>Cancel</button>
                <ajax-button type="button" :syncing="submittingComment" @click="submitComment()" class="btn btn-sm btn-dark mb-1">Submit comment</ajax-button>
            </div>
        </div>


        <div class="mt-3">
            <div v-if="commentsLoading" class="text-center">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Loading...</span>
                </div>
            </div>
            <div v-else >
                <div v-for="comment in commentList" class="border  rounded p-3 mb-2" :id="'comment_' + comment.id">
                    <div class="user-content">
                        {{comment.textContent}}
                    </div>
                    <div>
                        <a :href="'/' + comment.username">{{comment.displayUsername}}</a>
                    </div>
                </div>
                <div class="text-center mt-4">
                    <button type="button" class="btn btn-info" @click="loadComments()" v-if="hasMoreComments">Load more</button>
                </div>
            </div>
        </div>
    </div>
</div>
<%- /* Expose server-rendered data as window.SAILS_LOCALS :: */ exposeLocalsToBrowser() %>
